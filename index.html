<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestión de productos</title>
</head>
<body>
  <h1>Gestión de productos</h1>

  <h2>Crear producto</h2>
  <form action="/productos" method="post">
    <input type="text" name="nombre" placeholder="Nombre">
    <input type="text" name="descripcion" placeholder="Descripción">
    <input type="number" name="precio" placeholder="Precio">
    <select name="categoria_id">
      <option value="">Seleccionar categoría</option>
      <option value="1">Categoría 1</option>
      <option value="2">Categoría 2</option>
    </select>
    <select name="proveedor_id">
      <option value="">Seleccionar proveedor</option>
      <option value="1">Proveedor 1</option>
      <option value="2">Proveedor 2</option>
    </select>
    <input type="submit" value="Crear">
  </form>

  <h2>Listado de productos</h2>
  <table>
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Descripción</th>
        <th>Precio</th>
        <th>Categoría</th>
        <th>Proveedor</th>
      </tr>
    </thead>
    <tbody id="listado-productos"></tbody>
  </table>

  <h2>Operaciones</h2>
  <button id="leer">Leer</button>
  <script src="model.js"></script>
  <script src="controllers.js"></script>
  <script src="index.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/json-server/0.16.3/json-server.min.js"></script>
  <script>
    const app = jsonServer.create();
    app.use(jsonServer.bodyParser());
    app.use(jsonServer.static("./productos"));
    app.listen(3000, () => console.log("Servidor iniciado en http://localhost:3000"));

    // Lee todos los productos
    document.getElementById("leer").addEventListener("click", function() {
      fetch("http://localhost:3000/productos")
        .then(response => response.json())
        .then(productos => {
          // Vacía la tabla
          document.getElementById("listado-productos").innerHTML = "";
          // Muestra todos los productos en la tabla
          for (var producto of productos) {
            var tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${producto.nombre}</td>
              <td>${producto.descripcion}</td>
              <td>${producto.precio}</td>
              <td>${producto.categoria.nombre}</td>
              <td>${producto.proveedor.nombre}</td>
            `;
            document.getElementById("listado-productos").appendChild(tr);
          }
        });
    });
  </script>
</body>
</html>
